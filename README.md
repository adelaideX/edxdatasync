EDX Data Sync
========================
Developed by AdelaideX DataCzar - 2016 to manage raw encrypted datafiles provided by EdX [https://www.edx.org] via S3.

Overview
-------------
This application is started at a set time each day and executes a number of tasks to manage the raw data files generated by EdX and once all tasks are completed a notification email is sent. 
The application is standalone but is forms an important precursor to providing required data files in a usable manner for ingestion by the UQX Optimus Ingestor. https://github.com/UQ-UQx/optimus_ingestor
A suitable directory structure is required to hold the files:

    /DataPackages
        /database_state (for **ingestor**)
            /latest (each ingested directory of files uncompressed for ingestor)
            /2014-01-01 (ingested directory of files)
            /2014-01-07 (ingested directory of files)
        /clickstream_logs (for **ingestor**)
            /latest (all log files for ingestor)
        /database-data (all zipped encrypted db data files from edx)
        /event-data
            /edge (all encrypted gzipped edge platform clickstream logs - daily)
            /edx (all decrypted gzipped edx platform clickstream logs - daily)
        /unzipped (interim state for db files uncompressed but not unencrypted)
            /database-data (this directory can be purged to save space)
                /2014-01-01 
                /2014-01-07
        /decrypted
            /database-data (decrypted db data files)
                /2014-01-01 
                /2014-01-07
            /event-data 
                /edge (decrypted gzipped edge platform clickstream logs - daily)
                /edx (decrypted gzipped edx platform clickstream logs - daily)
        
The logical order of tasks is:

*   Sync files from S3 to local directories
*   Move files and unzip those to be decrypted
*   Move files and decrypt files
*   Cleanup ingestor target directories
*   Sync subset of decrypted files to ingestor directories
*   Unpack any gzipped files for ingestor
*   Send email to notify of successful completion          

Preparation
-------------
Install Amazon Web Services Command Line Interface bundle
    
    curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"
    unzip awscli-bundle.zip
    sudo ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws

Set-up AWS profile
    cd ~
Add your key details as decrypted with GPG.

    $ aws configure --profile my_profile
    AWS Access Key ID [None]: AKIAI44QH8DHBEXAMPLE --this is an example!
    AWS Secret Access Key [None]: je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY --this is an example!
    Default region name [None]: 
    Default output format [None]: 

Test that your configuration is working.

    aws --profile my_profile s3 ls course-data
    aws --profile my_profile s3 ls edx-course-data/my_institution/edge/events/2015/


Set up the edxDataSync
----------------------
**Requirements** 
    
    Python 2.7
    python-virtualenv
    pip
 
You can use the setup.sh script to check your config and setup virtualenv.
    
    git clone https://github.com/adelaideX/edxdatasync.git
    cd edxdatasync
    ./setup.sh
    source virtualenv/bin/activate

Or install manually
    
    git clone https://github.com/adelaideX/edxdatasync.git
    
    set up virtualenv [http://docs.python-guide.org/en/latest/dev/virtualenvs/](virtualenvs)
    
    # with the env pip install requirements
    (.env)$ pip install -r requirements.txt
    
    # selinux enforcing only
    (.env)$ sudo find ../.virtualenv/lib/python2.7/site-packages -name \*.so -exec chcon -t shlib_t {} \;


Rename example_config.py to config.py and example_main.sh to main.sh

    Adjust the two config files to suit your environment

Edit the email notification email body and content in notify.py

Crontab the edxdatasync to run daily
